<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Seed Frames into IndexedDB</title>
  <style>
    body { font-family: system-ui; background: #111; color: #eee; padding: 40px; }
    .done { color: #4ade80; }
    .err { color: #f87171; }
    button { font-size: 18px; padding: 12px 32px; cursor: pointer; border-radius: 8px; border: none; background: #fff; color: #111; font-weight: 600; }
    #log { margin-top: 20px; font-size: 14px; font-family: monospace; white-space: pre-wrap; }
    .info { margin-bottom: 24px; color: #a1a1aa; }
  </style>
</head>
<body>
  <h1>Seed Device Frames</h1>
  <p class="info">
    Drop a folder of frame PNGs here, or click below to pick files.<br>
    Files should be named like: <code>iPhone 17 - Black - Portrait.png</code>
  </p>
  <input type="file" id="files" multiple accept="image/png" style="display:none">
  <button onclick="document.getElementById('files').click()">Select frame PNGs</button>
  <div id="log"></div>

  <script>
    const DB_NAME = "mockup-frames";
    const DB_VERSION = 1;
    const STORE_NAME = "frames";

    // Map filename patterns to device IDs and color names
    const DEVICE_MAP = {
      "iPhone 17 Pro Max": "iphone-17-pro-max",
      "iPhone 17 Pro": "iphone-17-pro",
      "iPhone 17": "iphone-17",
      "iPhone Air": "iphone-air",
    };

    function openDB() {
      return new Promise((resolve, reject) => {
        const req = indexedDB.open(DB_NAME, DB_VERSION);
        req.onupgradeneeded = () => req.result.createObjectStore(STORE_NAME);
        req.onsuccess = () => resolve(req.result);
        req.onerror = () => reject(req.error);
      });
    }

    function putFrame(db, key, blob) {
      return new Promise((resolve, reject) => {
        const tx = db.transaction(STORE_NAME, "readwrite");
        tx.objectStore(STORE_NAME).put(blob, key);
        tx.oncomplete = () => resolve();
        tx.onerror = () => reject(tx.error);
      });
    }

    function log(msg, cls = "") {
      const el = document.getElementById("log");
      el.innerHTML += `<span class="${cls}">${msg}</span>\n`;
    }

    function parseFilename(name) {
      // "iPhone 17 - Black - Portrait.png" → { device: "iphone-17", color: "black" }
      if (!name.includes("Portrait")) return null;

      for (const [prefix, deviceId] of Object.entries(DEVICE_MAP)) {
        if (name.startsWith(prefix + " - ")) {
          const rest = name.slice(prefix.length + 3); // " - Black - Portrait.png" → "Black - Portrait.png"
          const color = rest.replace(" - Portrait.png", "").toLowerCase().replace(/\s+/g, "-");
          return { deviceId, color };
        }
      }
      return null;
    }

    document.getElementById("files").addEventListener("change", async (e) => {
      const files = Array.from(e.target.files);
      if (!files.length) return;

      log(`Found ${files.length} files, importing...`);
      const db = await openDB();
      let imported = 0;

      for (const file of files) {
        const parsed = parseFilename(file.name);
        if (!parsed) {
          log(`  Skipped: ${file.name} (not a portrait frame)`, "err");
          continue;
        }
        const key = `${parsed.deviceId}/${parsed.color}`;
        await putFrame(db, key, file);
        log(`  ✓ ${key}`, "done");
        imported++;
      }

      log(`\nDone! Imported ${imported} frames. You can now use the mockup generator.`, "done");
    });
  </script>
</body>
</html>
